<div class="laboratorio-container">

  <div class="page-header">
    <div class="container">
      <h1>ğŸ”¬ LaboratÃ³rio INOVALAB</h1>
      <p>Gerencie seus agendamentos de laboratÃ³rio</p>
      <button class="btn-novo-agendamento" (click)="abrirFormulario()">
        <i class="icon">â•</i>
        Novo Agendamento
      </button>
    </div>
  </div>


  <div class="modal-overlay" *ngIf="mostrarFormulario" (click)="fecharFormulario()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>{{ agendamentoEditando ? 'Editar' : 'Novo' }} Agendamento</h2>
        <button class="btn-fechar" (click)="fecharFormulario()">âœ•</button>
      </div>

      <form class="agendamento-form" (ngSubmit)="salvarAgendamento()">
        <div class="form-group">
          <label for="titulo">TÃ­tulo *</label>
          <input
            type="text"
            id="titulo"
            [(ngModel)]="novoAgendamento.titulo"
            name="titulo"
            required
            placeholder="Digite o tÃ­tulo do agendamento"
            class="form-input"
          >
        </div>

        <div class="form-group">
          <label for="data">Data * (mÃ­nimo: amanhÃ£)</label>
          <input
            type="date"
            id="data"
            [(ngModel)]="novoAgendamento.data"
            name="data"
            required
            [min]="getDataMinima()"
            class="form-input"
          >
        </div>

        <div class="form-group">
          <label for="descricao">DescriÃ§Ã£o *</label>
          <textarea
            id="descricao"
            [(ngModel)]="novoAgendamento.descricao"
            name="descricao"
            required
            placeholder="Descreva detalhes do agendamento..."
            class="form-textarea"
            rows="4"
          ></textarea>
        </div>

        <div class="form-actions">
          <button type="button" class="btn-cancelar" (click)="fecharFormulario()">
            Cancelar
          </button>
          <button type="submit" class="btn-salvar">
            {{ agendamentoEditando ? 'Atualizar' : 'Agendar' }}
          </button>
        </div>
      </form>
    </div>
  </div>


  <div class="agendamentos-section">
    <div class="container">
      <div class="section-title">
        <h2>Agendamentos</h2>
        <span class="total">{{ agendamentos.length }} agendamento(s)</span>
      </div>


      <div class="agendamentos-grid" *ngIf="agendamentos.length > 0">
        <div class="agendamento-card" *ngFor="let agendamento of agendamentos">
          <div class="card-header">
            <h3>{{ agendamento.titulo }}</h3>
            <span class="status-badge" [class]="getStatusClass(agendamento.status)">
              {{ getStatusText(agendamento.status) }}
            </span>
          </div>

          <div class="card-content">
            <div class="agendamento-info">
              <div class="info-item">
                <i class="icon">ğŸ“…</i>
                <span>{{ formatarData(agendamento.data) }}</span>
              </div>
              <div class="info-item">
                <i class="icon">ğŸ‘¤</i>
                <span>{{ agendamento.usuario }}</span>
              </div>
            </div>

            <p class="descricao">{{ agendamento.descricao }}</p>
          </div>

          <div class="card-actions">
            <!-- BotÃµes de status (apenas para admin) -->
            <div class="status-actions" *ngIf="isAdmin">
              <label>Alterar Status:</label>
              <div class="status-buttons">
                <button
                  class="btn-status btn-aprovado"
                  [disabled]="agendamento.status.toLowerCase() === 'aprovado'"
                  (click)="alterarStatusAgendamento(agendamento, 'aprovado')"
                  title="Aprovar agendamento"
                >
                  âœ“ Aprovado
                </button>
                <button
                  class="btn-status btn-pendente"
                  [disabled]="agendamento.status.toLowerCase() === 'pendente'"
                  (click)="alterarStatusAgendamento(agendamento, 'pendente')"
                  title="Marcar como pendente"
                >
                  â³ Pendente
                </button>
                <button
                  class="btn-status btn-reprovado"
                  [disabled]="agendamento.status.toLowerCase() === 'reprovado'"
                  (click)="alterarStatusAgendamento(agendamento, 'reprovado')"
                  title="Reprovar agendamento"
                >
                  âœ— Reprovado
                </button>
              </div>
            </div>

            <!-- BotÃµes de aÃ§Ã£o -->
            <div class="action-buttons">
              <button
                class="btn-action btn-editar"
                (click)="editarAgendamento(agendamento)"
              >
                <i class="icon">âœï¸</i>
                Editar
              </button>

              <button
                class="btn-action btn-excluir"
                (click)="excluirAgendamento(agendamento.id)"
              >
                <i class="icon">ğŸ—‘ï¸</i>
                Excluir
              </button>
            </div>
          </div>
        </div>
      </div>


      <div class="empty-state" *ngIf="agendamentos.length === 0">
        <div class="empty-icon">ğŸ“…</div>
        <h3>Nenhum agendamento encontrado</h3>
        <p>Clique no botÃ£o "Novo Agendamento" para criar seu primeiro agendamento.</p>
        <button class="btn-criar-primeiro" (click)="abrirFormulario()">
          Criar Primeiro Agendamento
        </button>
      </div>
    </div>
  </div>
</div>
