<div class="perfil-container">
  <div class="perfil-card">
    <div class="perfil-header">
      <button class="back-button" (click)="voltarInicio()">
        ‚Üê Voltar para o in√≠cio
      </button>
      <h1>Meu Perfil</h1>
      <p>Gerencie suas informa√ß√µes pessoais</p>
    </div>

    <div class="perfil-content" *ngIf="usuario">

      <div class="perfil-view" *ngIf="!modoEdicao">
        <div class="perfil-avatar">
          <div class="avatar-placeholder">
            <span class="avatar-text">{{ getAvatarText() }}</span>
          </div>
        </div>

        <div class="perfil-sections">

          <!-- Perfil de Pessoa F√≠sica -->
          <div *ngIf="usuario.tipo === 'usuario'" class="info-section">
            <h3>Dados Pessoais</h3>
            <div class="info-grid">
              <div class="info-item">
                <label>Nome Completo:</label>
                <span>{{ (usuario.nome || '') + ' ' + (usuario.sobrenome || '') || 'N√£o informado' }}</span>
              </div>

              <div class="info-item">
                <label>Email:</label>
                <span>{{ usuario.email }}</span>
              </div>

              <div class="info-item">
                <label>Usu√°rio:</label>
                <span>{{ usuario.nomeUsuario || 'N√£o informado' }}</span>
              </div>

              <div class="info-item">
                <label>Telefone:</label>
                <span>{{ usuario.telefone || 'N√£o informado' }}</span>
              </div>

              <div class="info-item">
                <label>Matr√≠cula:</label>
                <span>{{ usuario.matricula || 'N√£o informada' }}</span>
              </div>
            </div>
          </div>

          <!-- Perfil de Empresa -->
          <div *ngIf="usuario.tipo === 'empresa'" class="info-section">
            <h3>Dados da Empresa</h3>
            <div class="info-grid">
              <div class="info-item">
                <label>Raz√£o Social:</label>
                <span>{{ usuario.razaoSocial || 'N√£o informada' }}</span>
              </div>

              <div class="info-item">
                <label>Nome Fantasia:</label>
                <span>{{ usuario.nomeFantasia || 'N√£o informado' }}</span>
              </div>

              <div class="info-item">
                <label>CNPJ:</label>
                <span>{{ usuario.cnpj || 'N√£o informado' }}</span>
              </div>

              <div class="info-item">
                <label>Email:</label>
                <span>{{ usuario.email }}</span>
              </div>

              <div class="info-item">
                <label>Telefone:</label>
                <span>{{ usuario.telefone || 'N√£o informado' }}</span>
              </div>
            </div>
          </div>

          <!-- Informa√ß√µes do Respons√°vel (s√≥ para empresas) -->
          <div *ngIf="usuario.tipo === 'empresa'" class="info-section">
            <h3>Respons√°vel Legal</h3>
            <div class="info-grid">
              <div class="info-item">
                <label>Nome do Respons√°vel:</label>
                <span>{{ usuario.responsavelNome || 'N√£o informado' }}</span>
              </div>

              <div class="info-item">
                <label>Telefone do Respons√°vel:</label>
                <span>{{ usuario.responsavelTelefone || 'N√£o informado' }}</span>
              </div>
            </div>
          </div>


          <div class="info-section">
            <h3>Endere√ßo</h3>
            <div class="info-grid">
              <div class="info-item">
                <label>CEP:</label>
                <span>{{ usuario.endereco?.cep || 'N√£o informado' }}</span>
              </div>

              <div class="info-item">
                <label>Rua:</label>
                <span>{{ usuario.endereco?.rua || 'N√£o informada' }}</span>
              </div>

              <div class="info-item">
                <label>Bairro:</label>
                <span>{{ usuario.endereco?.bairro || 'N√£o informado' }}</span>
              </div>

              <div class="info-item">
                <label>N√∫mero:</label>
                <span>{{ usuario.endereco?.numero || 'N√£o informado' }}</span>
              </div>

              <div class="info-item">
                <label>Complemento:</label>
                <span>{{ usuario.endereco?.complemento || 'N√£o informado' }}</span>
              </div>

              <div class="info-item">
                <label>Refer√™ncia:</label>
                <span>{{ usuario.endereco?.referencia || 'N√£o informada' }}</span>
              </div>
            </div>
          </div>


          <div class="info-section">
            <h3>Informa√ß√µes do Sistema</h3>
            <div class="info-grid">
              <div class="info-item">
                <label>Membro desde:</label>
                <span>{{ formatarData(usuario.dataCriacao || '') }}</span>
              </div>
            </div>
          </div>
        </div>

        <div class="perfil-actions">
          <button class="edit-button" (click)="ativarEdicao()">
            Editar Perfil
          </button>
          <button class="delete-button" (click)="confirmarExclusao()" title="Excluir perfil permanentemente">
            üóëÔ∏è Excluir Perfil
          </button>
        </div>
      </div>


      <div class="perfil-edit" *ngIf="modoEdicao">
        <form class="edit-form" (ngSubmit)="salvarPerfil()">

          <div class="form-section">
            <h3>Dados Pessoais</h3>

            <div class="form-row">
              <div class="form-group">
                <label for="nome">Nome: <span class="required">*</span></label>
                <input
                  type="text"
                  id="nome"
                  [(ngModel)]="perfilForm.nome"
                  name="nome"
                  class="form-input"
                  placeholder="Digite seu nome"
                  required>
              </div>

              <div class="form-group">
                <label for="sobrenome">Sobrenome: <span class="required">*</span></label>
                <input
                  type="text"
                  id="sobrenome"
                  [(ngModel)]="perfilForm.sobrenome"
                  name="sobrenome"
                  class="form-input"
                  placeholder="Digite seu sobrenome"
                  required>
              </div>
            </div>

            <div class="form-group">
              <label for="email">Email:</label>
              <input
                type="email"
                id="email"
                [value]="usuario.email"
                disabled
                class="form-input disabled">
              <small class="form-hint">O email n√£o pode ser alterado</small>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="usuario">Usu√°rio:</label>
                <input
                  type="text"
                  id="usuario"
                  [(ngModel)]="perfilForm.usuario"
                  name="usuario"
                  class="form-input"
                  placeholder="Nome de usu√°rio">
              </div>

              <div class="form-group">
                <label for="telefone">Telefone:</label>
                <input
                  type="tel"
                  id="telefone"
                  [(ngModel)]="perfilForm.telefone"
                  name="telefone"
                  class="form-input"
                  placeholder="(11) 99999-9999"
                  (blur)="formatarTelefone()">
              </div>
            </div>

            <div class="form-group">
              <label for="matricula">Matr√≠cula:</label>
              <input
                type="text"
                id="matricula"
                [(ngModel)]="perfilForm.matricula"
                name="matricula"
                class="form-input"
                placeholder="N√∫mero da matr√≠cula">
            </div>
          </div>


          <div class="form-section">
            <h3>Informa√ß√µes Acad√™micas</h3>

            <div class="form-row">
              <div class="form-group">
                <label for="instituicao">Institui√ß√£o:</label>
                <input
                  type="text"
                  id="instituicao"
                  [(ngModel)]="perfilForm.instituicao"
                  name="instituicao"
                  class="form-input"
                  placeholder="Nome da sua institui√ß√£o">
              </div>

              <div class="form-group">
                <label for="curso">Curso:</label>
                <input
                  type="text"
                  id="curso"
                  [(ngModel)]="perfilForm.curso"
                  name="curso"
                  class="form-input"
                  placeholder="Seu curso ou √°rea de estudo">
              </div>
            </div>

            <div class="form-group">
              <label for="bio">Biografia:</label>
              <textarea
                id="bio"
                [(ngModel)]="perfilForm.bio"
                name="bio"
                class="form-input textarea"
                placeholder="Conte um pouco sobre voc√™, seus interesses e objetivos..."
                rows="4"
                maxlength="500"></textarea>
              <small class="form-hint">{{ perfilForm.bio.length }}/500 caracteres</small>
            </div>
          </div>


          <div class="form-section">
            <h3>Endere√ßo</h3>

            <div class="form-row">
              <div class="form-group">
                <label for="cep">CEP:</label>
                <input
                  type="text"
                  id="cep"
                  [(ngModel)]="perfilForm.cep"
                  name="cep"
                  class="form-input"
                  placeholder="00000-000"
                  (blur)="formatarCEP()">
              </div>

              <div class="form-group">
                <label for="bairro">Bairro:</label>
                <input
                  type="text"
                  id="bairro"
                  [(ngModel)]="perfilForm.bairro"
                  name="bairro"
                  class="form-input"
                  placeholder="Nome do bairro">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="rua">Rua:</label>
                <input
                  type="text"
                  id="rua"
                  [(ngModel)]="perfilForm.rua"
                  name="rua"
                  class="form-input"
                  placeholder="Nome da rua">
              </div>

              <div class="form-group">
                <label for="numero">N√∫mero:</label>
                <input
                  type="text"
                  id="numero"
                  [(ngModel)]="perfilForm.numero"
                  name="numero"
                  class="form-input"
                  placeholder="N√∫mero da resid√™ncia">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="complemento">Complemento:</label>
                <input
                  type="text"
                  id="complemento"
                  [(ngModel)]="perfilForm.complemento"
                  name="complemento"
                  class="form-input"
                  placeholder="Apto, bloco, etc.">
              </div>

              <div class="form-group">
                <label for="referencia">Refer√™ncia:</label>
                <input
                  type="text"
                  id="referencia"
                  [(ngModel)]="perfilForm.referencia"
                  name="referencia"
                  class="form-input"
                  placeholder="Ponto de refer√™ncia">
              </div>
            </div>
          </div>

          <div class="form-actions">
            <button type="button" class="cancel-button" (click)="cancelarEdicao()">
              Cancelar
            </button>
            <button type="submit" class="save-button">
              Salvar
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Modal de Confirma√ß√£o de Exclus√£o -->
  <div class="modal-overlay" *ngIf="mostrarModalExclusao" (click)="cancelarExclusao()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>‚ö†Ô∏è Confirmar Exclus√£o</h3>
        <button class="modal-close" (click)="cancelarExclusao()">‚úï</button>
      </div>

      <div class="modal-body">
        <div class="warning-icon">üö®</div>
        <h4>Tem certeza que deseja excluir seu perfil?</h4>
        <p class="warning-text">
          <strong>Esta a√ß√£o n√£o pode ser desfeita!</strong> Todos os seus dados ser√£o permanentemente removidos do sistema, incluindo:
        </p>
        <ul class="warning-list">
          <li>Informa√ß√µes pessoais</li>
          <li>Dados de endere√ßo</li>
          <li>Hist√≥rico de atividades</li>
          <li>Publica√ß√µes e agendamentos</li>
        </ul>
        <p class="final-warning">
          Voc√™ precisar√° criar uma nova conta para usar o sistema novamente.
        </p>
      </div>

      <div class="modal-footer">
        <button class="modal-cancel" (click)="cancelarExclusao()">
          Cancelar
        </button>
        <button class="modal-confirm" (click)="excluirPerfil()">
          Sim, Excluir Perfil
        </button>
      </div>
    </div>
  </div>
</div>

